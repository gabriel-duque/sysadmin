server.modules += ( "mod_cgi", "mod_rewrite", "mod_redirect", "mod_openssl" )

# 
$SERVER["socket"] == ":80" {
    $HTTP["host"] =~ "(.*)" {
        url.redirect = ( "^/(.*)" => "https://%1/$1" )
    }
}

$SERVER["socket"] == ":443" {
    ssl.engine                    = "enable"
    ssl.privkey                   = "/certs/git.zuh0.com.key"
    ssl.pemfile                   = "/certs/git.zuh0.com.crt"

    server.name          = "git.zuh0.com"
    server.document-root = "/usr/share/webapps/cgit/"

    index-file.names     = ( "cgit.cgi" )
    cgi.assign           = ( "cgit.cgi" => "" )
    url.rewrite-once     = (
        "^/([^?/]+/[^?]*)?(?:\?(.*))?$"   => "/cgit.cgi?url=$1&$2",
    )
}
